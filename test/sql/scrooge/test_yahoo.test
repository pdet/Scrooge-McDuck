# name: test/sql/scrooge/test_yahoo.test
# description: Test Yahoo Finance Scanner
# group: [scrooge]

require scrooge

require httpfs

statement error
select * FROM yahoo_finance()
----

statement error
select * FROM yahoo_finance("^aeouhae", "2017-12-01"::DATE, "2017-12-10"::DATE, "1d")
----

statement error
select * FROM yahoo_finance("^GSPC", "2017-12-11"::DATE, "2017-12-10"::DATE, "1d")
----

statement error
select * FROM yahoo_finance("^GSPC", "2017-12-11"::DATE, "2017-12-10"::DATE, -1)
----

query IIIIIIII
select * FROM yahoo_finance("^GSPC", "2017-12-01"::DATE, "2017-12-10"::DATE, "1d")
----
^GSPC	2017-12-01	2645.100098	2650.620117	2605.52002	2642.219971	2642.219971	3950930000
^GSPC	2017-12-04	2657.189941	2665.189941	2639.030029	2639.439941	2639.439941	4025840000
^GSPC	2017-12-05	2639.780029	2648.719971	2627.72998	2629.570068	2629.570068	3547570000
^GSPC	2017-12-06	2626.23999	2634.409912	2624.75	2629.27002	2629.27002	3253080000
^GSPC	2017-12-07	2628.379883	2640.98999	2626.530029	2636.97998	2636.97998	3297060000
^GSPC	2017-12-08	2646.209961	2651.649902	2644.100098	2651.5	2651.5	3126750000

# Try 5 day period
query IIIIIIII
select * FROM yahoo_finance("^GSPC", "2017-12-01"::DATE, "2017-12-10"::DATE, "5d")
----
^GSPC	2017-12-01	2645.100098	2650.620117	2605.52002	2642.219971	2642.219971	3950930000
^GSPC	2017-12-06	2626.23999	2634.409912	2624.75	2629.27002	2629.27002	3253080000


# Try 1wk period
query IIIIIIII
select * FROM yahoo_finance("^GSPC", "2017-12-01"::DATE, "2017-12-20"::DATE, "1wk")
----
^GSPC	2017-11-27	2633.929932	2657.73999	2605.52002	2642.219971	2642.219971	8916630000
^GSPC	2017-12-04	2657.189941	2665.189941	2624.75	2651.5	2651.5	17250300000
^GSPC	2017-12-11	2652.189941	2679.629883	2651.469971	2675.810059	2675.810059	19458420000
^GSPC	2017-12-18	2685.919922	2694.969971	2680.73999	2681.469971	2681.469971	7135450000


# Try 1mo period
query IIIIIIII
select * FROM yahoo_finance("^GSPC", "2017-12-01"::DATE, "2018-06-20"::DATE, "1mo")
----
^GSPC	2017-12-01	2645.100098	2694.969971	2605.52002	2673.610107	2673.610107	65531700000
^GSPC	2018-01-01	2683.72998	2872.870117	2682.360107	2823.810059	2823.810059	77318690000
^GSPC	2018-02-01	2816.449951	2835.959961	2532.689941	2713.830078	2713.830078	79933970000
^GSPC	2018-03-01	2715.219971	2801.899902	2585.889893	2640.870117	2640.870117	76803890000
^GSPC	2018-04-01	2633.449951	2717.48999	2553.800049	2648.050049	2648.050049	70194700000
^GSPC	2018-05-01	2642.959961	2742.23999	2594.620117	2705.27002	2705.27002	76011820000
^GSPC	2018-06-01	2718.699951	2791.469971	2691.98999	2718.370117	2718.370117	77891360000

# Try 3mo period
query IIIIIIII
select * FROM yahoo_finance("^GSPC", "2017-12-01"::DATE, "2018-06-20"::DATE, "3mo")
----
^GSPC	2017-12-01	2645.100098	2872.870117	2532.689941	2713.830078	2713.830078	222784360000
^GSPC	2018-03-01	2715.219971	2801.899902	2553.800049	2705.27002	2705.27002	223010410000
^GSPC	2018-06-01	2718.699951	2791.469971	2691.98999	2718.370117	2718.370117	77891360000

# Try Big Data
query IIIIIIII
select * FROM yahoo_finance("BTC-USD", "2015-01-01"::DATE, "2015-04-01"::DATE, "1d");
----
BTC-USD	2015-01-01	320.434998	320.434998	314.002991	314.248993	314.248993	8036550
BTC-USD	2015-01-02	314.07901	315.838989	313.565002	315.032013	315.032013	7860650
BTC-USD	2015-01-03	314.846008	315.149994	281.082001	281.082001	281.082001	33054400
BTC-USD	2015-01-04	281.145996	287.230011	257.612	264.195007	264.195007	55629100
BTC-USD	2015-01-05	265.084015	278.341003	265.084015	274.473999	274.473999	43962800
BTC-USD	2015-01-06	274.610992	287.553009	272.696014	286.188995	286.188995	23245700
BTC-USD	2015-01-07	286.076996	298.753998	283.07901	294.337006	294.337006	24866800
BTC-USD	2015-01-08	294.13501	294.13501	282.174988	283.348999	283.348999	19982500
BTC-USD	2015-01-09	282.382996	291.114014	280.53299	290.40799	290.40799	18718600
BTC-USD	2015-01-10	287.303009	288.127014	273.966003	274.79599	274.79599	15264300
BTC-USD	2015-01-11	274.608002	279.638	265.039001	265.660004	265.660004	18200800
BTC-USD	2015-01-12	266.145996	272.203003	265.200012	267.79599	267.79599	18880300
BTC-USD	2015-01-13	267.394012	268.277008	219.906006	225.860992	225.860992	72843904
BTC-USD	2015-01-14	223.893997	223.893997	171.509995	178.102997	178.102997	97638704
BTC-USD	2015-01-15	176.897003	229.067001	176.897003	209.843994	209.843994	81773504
BTC-USD	2015-01-16	209.070007	221.591003	199.770996	208.097	208.097	38421000
BTC-USD	2015-01-17	207.834	211.731003	194.875	199.259995	199.259995	23469700
BTC-USD	2015-01-18	200.050003	218.695007	194.505997	210.339005	210.339005	30085100
BTC-USD	2015-01-19	211.470993	216.727997	207.317993	214.860992	214.860992	18658300
BTC-USD	2015-01-20	212.906998	215.240997	205.153	211.315002	211.315002	24051100
BTC-USD	2015-01-21	211.378006	227.787994	211.212006	226.897003	226.897003	29924600
BTC-USD	2015-01-22	227.322006	237.018997	226.434006	233.406006	233.406006	33544600
BTC-USD	2015-01-23	233.516998	234.845001	225.195999	232.878998	232.878998	24621700
BTC-USD	2015-01-24	232.699997	248.210007	230.022003	247.847	247.847	24782500
BTC-USD	2015-01-25	247.352005	255.074005	243.889999	253.718002	253.718002	33582700
BTC-USD	2015-01-26	254.078995	309.384003	254.078995	273.472992	273.472992	106794000
BTC-USD	2015-01-27	273.166992	275.480011	250.653	263.475006	263.475006	44399000
BTC-USD	2015-01-28	263.351013	266.535004	227.046005	233.914993	233.914993	44352200
BTC-USD	2015-01-29	233.348007	238.705994	220.712006	233.513	233.513	32213400
BTC-USD	2015-01-30	232.772003	242.850998	225.839005	226.425003	226.425003	26605200
BTC-USD	2015-01-31	226.440994	233.503998	216.309006	217.464005	217.464005	23348200
BTC-USD	2015-02-01	216.867004	231.574005	212.014999	226.972	226.972	29128500
BTC-USD	2015-02-02	226.490997	242.175003	222.658997	238.229004	238.229004	30612100
BTC-USD	2015-02-03	237.453995	245.957001	224.483002	227.268005	227.268005	40783700
BTC-USD	2015-02-04	227.511002	230.057999	221.113007	226.852997	226.852997	26594300
BTC-USD	2015-02-05	227.664993	239.404999	214.725006	217.110992	217.110992	22516400
BTC-USD	2015-02-06	216.923004	230.509995	216.231995	222.266006	222.266006	24435300
BTC-USD	2015-02-07	222.632996	230.298996	222.606995	227.753998	227.753998	21604200
BTC-USD	2015-02-08	227.692993	229.438004	221.076996	223.412003	223.412003	17145200
BTC-USD	2015-02-09	223.389008	223.977005	217.018997	220.110001	220.110001	27791300
BTC-USD	2015-02-10	220.281998	221.807007	215.332001	219.839005	219.839005	21115100
BTC-USD	2015-02-11	219.731995	223.406006	218.074005	219.184998	219.184998	17201900
BTC-USD	2015-02-12	219.207993	222.199005	217.613998	221.764008	221.764008	15206200
BTC-USD	2015-02-13	221.968994	240.259003	221.261993	235.427002	235.427002	42744400
BTC-USD	2015-02-14	235.528	259.808014	235.528	257.321014	257.321014	49732500
BTC-USD	2015-02-15	257.506989	265.610992	227.684006	234.824997	234.824997	56552400
BTC-USD	2015-02-15	257.506989	265.610992	227.684006	234.824997	234.824997	56552400
BTC-USD	2015-02-16	234.824997	239.520996	229.022003	233.843002	233.843002	28153700
BTC-USD	2015-02-17	233.421997	245.774994	232.313995	243.610001	243.610001	27363100
BTC-USD	2015-02-18	243.779999	244.251007	232.339996	236.326004	236.326004	25200800
BTC-USD	2015-02-19	236.410004	242.671997	235.591995	240.283005	240.283005	18270500
BTC-USD	2015-02-20	240.251007	247.100998	239.298996	243.779007	243.779007	23876700
BTC-USD	2015-02-21	243.751999	255.320007	243.184006	244.533997	244.533997	12284200
BTC-USD	2015-02-22	244.544006	246.391998	233.850998	235.977005	235.977005	19527000
BTC-USD	2015-02-23	235.994995	240.108994	232.421005	238.891998	238.891998	16400000
BTC-USD	2015-02-24	238.998001	239.901001	236.401993	238.735001	238.735001	14200400
BTC-USD	2015-02-25	238.889999	239.339996	235.529999	237.470001	237.470001	11496200
BTC-USD	2015-02-26	237.337006	237.710007	234.257004	236.425995	236.425995	13619400
BTC-USD	2015-02-27	236.436005	256.653015	236.436005	253.828003	253.828003	44013900
BTC-USD	2015-02-28	253.520004	254.692001	249.479004	254.263	254.263	13949300
BTC-USD	2015-03-01	254.283005	261.660004	245.932999	260.201996	260.201996	25213700
BTC-USD	2015-03-02	260.356995	276.300995	258.312988	275.670013	275.670013	40465700
BTC-USD	2015-03-03	275.04599	285.79599	268.161011	281.701996	281.701996	50461300
BTC-USD	2015-03-04	281.98999	284.225006	268.126007	273.09201	273.09201	41383000
BTC-USD	2015-03-05	272.739014	281.666992	264.769012	276.178009	276.178009	41302400
BTC-USD	2015-03-06	275.600006	277.608002	270.015015	272.722992	272.722992	28918900
BTC-USD	2015-03-07	272.294006	277.854004	270.132996	276.260986	276.260986	17825900
BTC-USD	2015-03-08	276.433014	277.858002	272.565002	274.354004	274.354004	22067900
BTC-USD	2015-03-09	274.812012	292.700989	273.893005	289.606995	289.606995	59178200
BTC-USD	2015-03-10	289.862	300.044006	289.743011	291.76001	291.76001	67770800
BTC-USD	2015-03-11	291.524994	297.390991	290.507996	296.378998	296.378998	33963900
BTC-USD	2015-03-12	296.127014	297.088013	292.412994	294.354004	294.354004	32585200
BTC-USD	2015-03-13	294.118011	294.497986	285.337006	285.337006	285.337006	31421500
BTC-USD	2015-03-14	284.441986	286.34201	280.976013	281.88501	281.88501	22612300
BTC-USD	2015-03-15	281.424988	286.528992	280.996002	286.393005	286.393005	11970100
BTC-USD	2015-03-16	285.684998	294.112	285.684998	290.592987	290.592987	21516100
BTC-USD	2015-03-17	290.595001	292.36499	284.373993	285.505005	285.505005	21497200
BTC-USD	2015-03-18	285.066986	285.335999	249.869995	256.299011	256.299011	57008000
BTC-USD	2015-03-19	255.880005	264.243988	248.636002	260.928009	260.928009	52732000
BTC-USD	2015-03-20	260.955994	264.847992	259.161987	261.748993	261.748993	18456700
BTC-USD	2015-03-21	261.644012	262.196014	255.649994	260.024994	260.024994	17130100
BTC-USD	2015-03-22	259.916992	269.747009	259.589996	267.959991	267.959991	18438100
BTC-USD	2015-03-23	267.894989	277.296997	261.744995	266.73999	266.73999	22811900
BTC-USD	2015-03-24	266.576996	267.002991	244.154999	245.595001	245.595001	40073700
BTC-USD	2015-03-25	247.472	249.190002	236.514999	246.197006	246.197006	35866900
BTC-USD	2015-03-26	246.276001	254.354004	244.904999	248.531998	248.531998	25730000
BTC-USD	2015-03-27	248.565994	256.811005	245.212997	247.029007	247.029007	17274900
BTC-USD	2015-03-28	246.975006	254.205002	246.975006	252.798004	252.798004	16040900
BTC-USD	2015-03-29	252.740005	253.139008	240.850006	242.712997	242.712997	21699400
BTC-USD	2015-03-30	242.878998	249.242004	239.214005	247.526001	247.526001	23009600
BTC-USD	2015-03-31	247.453995	248.729996	242.738998	244.223999	244.223999	22672000
BTC-USD	2015-04-01	244.223007	247.541	241.160004	247.272003	247.272003	22877200

statement error
select * FROM yahoo_finance(["oejoeaijeao"], "2015-01-01"::DATE, "2015-04-01"::DATE, "1d");
----

statement error
select * FROM yahoo_finance([], "2015-01-01"::DATE, "2015-04-01"::DATE, "1d");
----

# Try Big Data
query IIIIIIII
select * FROM yahoo_finance(["BTC-USD", "^GSPC"], "2015-01-01"::DATE, "2015-04-01"::DATE, "1d");
----
BTC-USD	2015-01-01	320.434998	320.434998	314.002991	314.248993	314.248993	8036550
BTC-USD	2015-01-02	314.07901	315.838989	313.565002	315.032013	315.032013	7860650
BTC-USD	2015-01-03	314.846008	315.149994	281.082001	281.082001	281.082001	33054400
BTC-USD	2015-01-04	281.145996	287.230011	257.612	264.195007	264.195007	55629100
BTC-USD	2015-01-05	265.084015	278.341003	265.084015	274.473999	274.473999	43962800
BTC-USD	2015-01-06	274.610992	287.553009	272.696014	286.188995	286.188995	23245700
BTC-USD	2015-01-07	286.076996	298.753998	283.07901	294.337006	294.337006	24866800
BTC-USD	2015-01-08	294.13501	294.13501	282.174988	283.348999	283.348999	19982500
BTC-USD	2015-01-09	282.382996	291.114014	280.53299	290.40799	290.40799	18718600
BTC-USD	2015-01-10	287.303009	288.127014	273.966003	274.79599	274.79599	15264300
BTC-USD	2015-01-11	274.608002	279.638	265.039001	265.660004	265.660004	18200800
BTC-USD	2015-01-12	266.145996	272.203003	265.200012	267.79599	267.79599	18880300
BTC-USD	2015-01-13	267.394012	268.277008	219.906006	225.860992	225.860992	72843904
BTC-USD	2015-01-14	223.893997	223.893997	171.509995	178.102997	178.102997	97638704
BTC-USD	2015-01-15	176.897003	229.067001	176.897003	209.843994	209.843994	81773504
BTC-USD	2015-01-16	209.070007	221.591003	199.770996	208.097	208.097	38421000
BTC-USD	2015-01-17	207.834	211.731003	194.875	199.259995	199.259995	23469700
BTC-USD	2015-01-18	200.050003	218.695007	194.505997	210.339005	210.339005	30085100
BTC-USD	2015-01-19	211.470993	216.727997	207.317993	214.860992	214.860992	18658300
BTC-USD	2015-01-20	212.906998	215.240997	205.153	211.315002	211.315002	24051100
BTC-USD	2015-01-21	211.378006	227.787994	211.212006	226.897003	226.897003	29924600
BTC-USD	2015-01-22	227.322006	237.018997	226.434006	233.406006	233.406006	33544600
BTC-USD	2015-01-23	233.516998	234.845001	225.195999	232.878998	232.878998	24621700
BTC-USD	2015-01-24	232.699997	248.210007	230.022003	247.847	247.847	24782500
BTC-USD	2015-01-25	247.352005	255.074005	243.889999	253.718002	253.718002	33582700
BTC-USD	2015-01-26	254.078995	309.384003	254.078995	273.472992	273.472992	106794000
BTC-USD	2015-01-27	273.166992	275.480011	250.653	263.475006	263.475006	44399000
BTC-USD	2015-01-28	263.351013	266.535004	227.046005	233.914993	233.914993	44352200
BTC-USD	2015-01-29	233.348007	238.705994	220.712006	233.513	233.513	32213400
BTC-USD	2015-01-30	232.772003	242.850998	225.839005	226.425003	226.425003	26605200
BTC-USD	2015-01-31	226.440994	233.503998	216.309006	217.464005	217.464005	23348200
BTC-USD	2015-02-01	216.867004	231.574005	212.014999	226.972	226.972	29128500
BTC-USD	2015-02-02	226.490997	242.175003	222.658997	238.229004	238.229004	30612100
BTC-USD	2015-02-03	237.453995	245.957001	224.483002	227.268005	227.268005	40783700
BTC-USD	2015-02-04	227.511002	230.057999	221.113007	226.852997	226.852997	26594300
BTC-USD	2015-02-05	227.664993	239.404999	214.725006	217.110992	217.110992	22516400
BTC-USD	2015-02-06	216.923004	230.509995	216.231995	222.266006	222.266006	24435300
BTC-USD	2015-02-07	222.632996	230.298996	222.606995	227.753998	227.753998	21604200
BTC-USD	2015-02-08	227.692993	229.438004	221.076996	223.412003	223.412003	17145200
BTC-USD	2015-02-09	223.389008	223.977005	217.018997	220.110001	220.110001	27791300
BTC-USD	2015-02-10	220.281998	221.807007	215.332001	219.839005	219.839005	21115100
BTC-USD	2015-02-11	219.731995	223.406006	218.074005	219.184998	219.184998	17201900
BTC-USD	2015-02-12	219.207993	222.199005	217.613998	221.764008	221.764008	15206200
BTC-USD	2015-02-13	221.968994	240.259003	221.261993	235.427002	235.427002	42744400
BTC-USD	2015-02-14	235.528	259.808014	235.528	257.321014	257.321014	49732500
BTC-USD	2015-02-15	257.506989	265.610992	227.684006	234.824997	234.824997	56552400
BTC-USD	2015-02-15	257.506989	265.610992	227.684006	234.824997	234.824997	56552400
BTC-USD	2015-02-16	234.824997	239.520996	229.022003	233.843002	233.843002	28153700
BTC-USD	2015-02-17	233.421997	245.774994	232.313995	243.610001	243.610001	27363100
BTC-USD	2015-02-18	243.779999	244.251007	232.339996	236.326004	236.326004	25200800
BTC-USD	2015-02-19	236.410004	242.671997	235.591995	240.283005	240.283005	18270500
BTC-USD	2015-02-20	240.251007	247.100998	239.298996	243.779007	243.779007	23876700
BTC-USD	2015-02-21	243.751999	255.320007	243.184006	244.533997	244.533997	12284200
BTC-USD	2015-02-22	244.544006	246.391998	233.850998	235.977005	235.977005	19527000
BTC-USD	2015-02-23	235.994995	240.108994	232.421005	238.891998	238.891998	16400000
BTC-USD	2015-02-24	238.998001	239.901001	236.401993	238.735001	238.735001	14200400
BTC-USD	2015-02-25	238.889999	239.339996	235.529999	237.470001	237.470001	11496200
BTC-USD	2015-02-26	237.337006	237.710007	234.257004	236.425995	236.425995	13619400
BTC-USD	2015-02-27	236.436005	256.653015	236.436005	253.828003	253.828003	44013900
BTC-USD	2015-02-28	253.520004	254.692001	249.479004	254.263	254.263	13949300
BTC-USD	2015-03-01	254.283005	261.660004	245.932999	260.201996	260.201996	25213700
BTC-USD	2015-03-02	260.356995	276.300995	258.312988	275.670013	275.670013	40465700
BTC-USD	2015-03-03	275.04599	285.79599	268.161011	281.701996	281.701996	50461300
BTC-USD	2015-03-04	281.98999	284.225006	268.126007	273.09201	273.09201	41383000
BTC-USD	2015-03-05	272.739014	281.666992	264.769012	276.178009	276.178009	41302400
BTC-USD	2015-03-06	275.600006	277.608002	270.015015	272.722992	272.722992	28918900
BTC-USD	2015-03-07	272.294006	277.854004	270.132996	276.260986	276.260986	17825900
BTC-USD	2015-03-08	276.433014	277.858002	272.565002	274.354004	274.354004	22067900
BTC-USD	2015-03-09	274.812012	292.700989	273.893005	289.606995	289.606995	59178200
BTC-USD	2015-03-10	289.862	300.044006	289.743011	291.76001	291.76001	67770800
BTC-USD	2015-03-11	291.524994	297.390991	290.507996	296.378998	296.378998	33963900
BTC-USD	2015-03-12	296.127014	297.088013	292.412994	294.354004	294.354004	32585200
BTC-USD	2015-03-13	294.118011	294.497986	285.337006	285.337006	285.337006	31421500
BTC-USD	2015-03-14	284.441986	286.34201	280.976013	281.88501	281.88501	22612300
BTC-USD	2015-03-15	281.424988	286.528992	280.996002	286.393005	286.393005	11970100
BTC-USD	2015-03-16	285.684998	294.112	285.684998	290.592987	290.592987	21516100
BTC-USD	2015-03-17	290.595001	292.36499	284.373993	285.505005	285.505005	21497200
BTC-USD	2015-03-18	285.066986	285.335999	249.869995	256.299011	256.299011	57008000
BTC-USD	2015-03-19	255.880005	264.243988	248.636002	260.928009	260.928009	52732000
BTC-USD	2015-03-20	260.955994	264.847992	259.161987	261.748993	261.748993	18456700
BTC-USD	2015-03-21	261.644012	262.196014	255.649994	260.024994	260.024994	17130100
BTC-USD	2015-03-22	259.916992	269.747009	259.589996	267.959991	267.959991	18438100
BTC-USD	2015-03-23	267.894989	277.296997	261.744995	266.73999	266.73999	22811900
BTC-USD	2015-03-24	266.576996	267.002991	244.154999	245.595001	245.595001	40073700
BTC-USD	2015-03-25	247.472	249.190002	236.514999	246.197006	246.197006	35866900
BTC-USD	2015-03-26	246.276001	254.354004	244.904999	248.531998	248.531998	25730000
BTC-USD	2015-03-27	248.565994	256.811005	245.212997	247.029007	247.029007	17274900
BTC-USD	2015-03-28	246.975006	254.205002	246.975006	252.798004	252.798004	16040900
BTC-USD	2015-03-29	252.740005	253.139008	240.850006	242.712997	242.712997	21699400
BTC-USD	2015-03-30	242.878998	249.242004	239.214005	247.526001	247.526001	23009600
BTC-USD	2015-03-31	247.453995	248.729996	242.738998	244.223999	244.223999	22672000
BTC-USD	2015-04-01	244.223007	247.541	241.160004	247.272003	247.272003	22877200
^GSPC	2015-01-02	2058.899902	2072.360107	2046.040039	2058.199951	2058.199951	2708700000
^GSPC	2015-01-05	2054.439941	2054.439941	2017.339966	2020.579956	2020.579956	3799120000
^GSPC	2015-01-06	2022.150024	2030.25	1992.439941	2002.609985	2002.609985	4460110000
^GSPC	2015-01-07	2005.550049	2029.609985	2005.550049	2025.900024	2025.900024	3805480000
^GSPC	2015-01-08	2030.609985	2064.080078	2030.609985	2062.139893	2062.139893	3934010000
^GSPC	2015-01-09	2063.449951	2064.429932	2038.329956	2044.810059	2044.810059	3364140000
^GSPC	2015-01-12	2046.130005	2049.300049	2022.579956	2028.26001	2028.26001	3456460000
^GSPC	2015-01-13	2031.579956	2056.929932	2008.25	2023.030029	2023.030029	4107300000
^GSPC	2015-01-14	2018.400024	2018.400024	1988.439941	2011.27002	2011.27002	4378680000
^GSPC	2015-01-15	2013.75	2021.349976	1991.469971	1992.670044	1992.670044	4276720000
^GSPC	2015-01-16	1992.25	2020.459961	1988.119995	2019.420044	2019.420044	4056410000
^GSPC	2015-01-20	2020.76001	2028.939941	2004.48999	2022.550049	2022.550049	3944340000
^GSPC	2015-01-21	2020.189941	2038.290039	2012.040039	2032.119995	2032.119995	3730070000
^GSPC	2015-01-22	2034.300049	2064.620117	2026.380005	2063.149902	2063.149902	4176050000
^GSPC	2015-01-23	2062.97998	2062.97998	2050.540039	2051.820068	2051.820068	3573560000
^GSPC	2015-01-26	2050.419922	2057.620117	2040.969971	2057.090088	2057.090088	3465760000
^GSPC	2015-01-27	2047.859985	2047.859985	2019.910034	2029.550049	2029.550049	3329810000
^GSPC	2015-01-28	2032.339966	2042.48999	2001.48999	2002.160034	2002.160034	4067530000
^GSPC	2015-01-29	2002.449951	2024.640015	1989.180054	2021.25	2021.25	4127140000
^GSPC	2015-01-30	2019.349976	2023.319946	1993.380005	1994.98999	1994.98999	4568650000
^GSPC	2015-02-02	1996.670044	2021.660034	1980.900024	2020.849976	2020.849976	4008330000
^GSPC	2015-02-03	2022.709961	2050.300049	2022.709961	2050.030029	2050.030029	4615900000
^GSPC	2015-02-04	2048.860107	2054.73999	2036.719971	2041.51001	2041.51001	4141920000
^GSPC	2015-02-05	2043.449951	2063.550049	2043.449951	2062.52002	2062.52002	3821990000
^GSPC	2015-02-06	2062.280029	2072.399902	2049.969971	2055.469971	2055.469971	4232970000
^GSPC	2015-02-09	2053.469971	2056.159912	2041.880005	2046.73999	2046.73999	3549540000
^GSPC	2015-02-10	2049.379883	2070.860107	2048.620117	2068.590088	2068.590088	3669850000
^GSPC	2015-02-11	2068.550049	2073.47998	2057.98999	2068.530029	2068.530029	3596860000
^GSPC	2015-02-12	2069.97998	2088.530029	2069.97998	2088.47998	2088.47998	3788350000
^GSPC	2015-02-13	2088.780029	2097.030029	2086.699951	2096.98999	2096.98999	3527450000
^GSPC	2015-02-17	2096.469971	2101.300049	2089.800049	2100.340088	2100.340088	3361750000
^GSPC	2015-02-18	2099.159912	2100.22998	2092.149902	2099.679932	2099.679932	3370020000
^GSPC	2015-02-19	2099.25	2102.129883	2090.790039	2097.449951	2097.449951	3247100000
^GSPC	2015-02-20	2097.649902	2110.610107	2085.439941	2110.300049	2110.300049	3281600000
^GSPC	2015-02-23	2109.830078	2110.050049	2103.0	2109.659912	2109.659912	3093680000
^GSPC	2015-02-24	2109.100098	2117.939941	2105.870117	2115.47998	2115.47998	3199840000
^GSPC	2015-02-25	2115.300049	2119.590088	2109.889893	2113.860107	2113.860107	3312340000
^GSPC	2015-02-26	2113.909912	2113.909912	2103.76001	2110.73999	2110.73999	3408690000
^GSPC	2015-02-27	2110.879883	2112.73999	2103.75	2104.5	2104.5	3547380000
^GSPC	2015-03-02	2105.22998	2117.52002	2104.5	2117.389893	2117.389893	3409490000
^GSPC	2015-03-03	2115.76001	2115.76001	2098.26001	2107.780029	2107.780029	3262300000
^GSPC	2015-03-04	2107.719971	2107.719971	2094.48999	2098.530029	2098.530029	3421110000
^GSPC	2015-03-05	2098.540039	2104.25	2095.219971	2101.040039	2101.040039	3103030000
^GSPC	2015-03-06	2100.909912	2100.909912	2067.27002	2071.26001	2071.26001	3853570000
^GSPC	2015-03-09	2072.25	2083.48999	2072.209961	2079.429932	2079.429932	3349090000
^GSPC	2015-03-10	2076.139893	2076.139893	2044.160034	2044.160034	2044.160034	3668900000
^GSPC	2015-03-11	2044.689941	2050.080078	2039.689941	2040.23999	2040.23999	3406570000
^GSPC	2015-03-12	2041.099976	2066.409912	2041.099976	2065.949951	2065.949951	3405860000
^GSPC	2015-03-13	2064.560059	2064.560059	2041.170044	2053.399902	2053.399902	3498560000
^GSPC	2015-03-16	2055.350098	2081.409912	2055.350098	2081.189941	2081.189941	3295600000
^GSPC	2015-03-17	2080.590088	2080.590088	2065.080078	2074.280029	2074.280029	3221840000
^GSPC	2015-03-18	2072.840088	2106.850098	2061.22998	2099.5	2099.5	4128210000
^GSPC	2015-03-19	2098.689941	2098.689941	2085.560059	2089.27002	2089.27002	3305220000
^GSPC	2015-03-20	2090.320068	2113.919922	2090.320068	2108.100098	2108.100098	5554120000
^GSPC	2015-03-23	2107.98999	2114.860107	2104.419922	2104.419922	2104.419922	3267960000
^GSPC	2015-03-24	2103.939941	2107.629883	2091.5	2091.5	2091.5	3189820000
^GSPC	2015-03-25	2093.100098	2097.429932	2061.050049	2061.050049	2061.050049	3521140000
^GSPC	2015-03-26	2059.939941	2067.149902	2045.5	2056.149902	2056.149902	3510670000
^GSPC	2015-03-27	2055.780029	2062.830078	2052.959961	2061.02002	2061.02002	3008550000
^GSPC	2015-03-30	2064.110107	2088.969971	2064.110107	2086.23999	2086.23999	2917690000
^GSPC	2015-03-31	2084.050049	2084.050049	2067.040039	2067.889893	2067.889893	3376550000

# Interval must be a string accepted by the yahoo api
statement error
select * FROM yahoo_finance("^GSPC", "2017-12-11"::DATE, "2017-12-12"::DATE, "bla")
----

# Periods can't be equal
statement error
select * FROM yahoo_finance("^GSPC", "2017-12-11"::DATE, "2017-12-11"::DATE, "1d")
----

# Interval can't be bigger than period
statement error
select * FROM yahoo_finance("^GSPC", "2017-12-11"::DATE, "2017-12-15"::DATE, "1mo")
----


# Start period must be castable to date
statement error
select * FROM yahoo_finance("^GSPC", "bla", "2017-12-15"::DATE, "1d")
----

# End period must be castable to date
statement error
select * FROM yahoo_finance("^GSPC", "2017-12-15"::DATE, "bla", "1d")
----

query I
select volatility(close) FROM yahoo_finance("^GSPC", "2017-12-01"::DATE, "2017-12-10"::DATE, "1d")
----
7.640770797901039

query I
select volatility(close) FROM yahoo_finance("^GSPC", "2017-12-01", "2017-12-10", "1d")
----
7.640770797901039

query I
select sma(close) FROM yahoo_finance("^GSPC", "2017-12-01"::DATE, "2017-12-10"::DATE, "1d")
----
2638.16333

query I
select volatility(close) FROM yahoo_finance("^GSPC", "2023-01-01"::DATE, "2023-02-18"::DATE, "1d")
----
101.31567537720929

query I
select volatility(close) FROM yahoo_finance("BTC-USD", "2023-01-01"::DATE, "2023-02-18"::DATE, "1d");
----
2535.839600150706


# Try Big Data
query I
select volatility(close) FROM yahoo_finance("BTC-USD", "2015-01-01"::DATE, "2023-02-18"::DATE, "1d");
----
16209.134078559835