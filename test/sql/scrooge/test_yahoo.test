# name: test/sql/scrooge/test_yahoo.test
# description: Test Yahoo Finance Scanner
# group: [scrooge]

require scrooge

require httpfs

require json

statement error
select * FROM yahoo_finance("^aeouhae", "2017-12-01"::DATE, "2017-12-10"::DATE, "1d")
----

statement error
select * FROM yahoo_finance("^GSPC", "2017-12-11"::DATE, "2017-12-10"::DATE, "1d")
----

statement error
select * FROM yahoo_finance("^GSPC", "2017-12-11"::DATE, "2017-12-10"::DATE, -1)
----

query IIIIIIII
select * FROM yahoo_finance("^GSPC", "2017-12-01"::DATE, "2017-12-10"::DATE, "1d")
----
^GSPC	[2017-12-01, 2017-12-04, 2017-12-05, 2017-12-06, 2017-12-07, 2017-12-08]	[2645.10009765625, 2657.18994140625, 2639.780029296875, 2626.239990234375, 2628.3798828125, 2646.2099609375]	[2650.6201171875, 2665.18994140625, 2648.719970703125, 2634.409912109375, 2640.989990234375, 2651.64990234375]	[2605.52001953125, 2639.030029296875, 2627.72998046875, 2624.75, 2626.530029296875, 2644.10009765625]	[2642.219970703125, 2639.43994140625, 2629.570068359375, 2629.27001953125, 2636.97998046875, 2651.5]	[2642.219970703125, 2639.43994140625, 2629.570068359375, 2629.27001953125, 2636.97998046875, 2651.5]	[3950930000, 4025840000, 3547570000, 3253080000, 3297060000, 3126750000]

# Try 5 day period
query IIIIIIII
select * FROM yahoo_finance("^GSPC", "2017-12-01"::DATE, "2017-12-10"::DATE, "5d")
----
^GSPC	[2017-12-01, 2017-12-06]	[2645.10009765625, 2626.239990234375]	[2650.6201171875, 2634.409912109375]	[2605.52001953125, 2624.75]	[2642.219970703125, 2629.27001953125]	[2642.219970703125, 2629.27001953125]	[3950930000, 3253080000]


# Try 1wk period
query IIIIIIII
select * FROM yahoo_finance("^GSPC", "2017-12-01"::DATE, "2017-12-20"::DATE, "1wk")
----
^GSPC	[2017-11-27, 2017-12-04, 2017-12-11, 2017-12-18]	[2633.929931640625, 2657.18994140625, 2652.18994140625, 2685.919921875]	[2657.739990234375, 2665.18994140625, 2679.6298828125, 2694.969970703125]	[2605.52001953125, 2624.75, 2651.469970703125, 2680.739990234375]	[2642.219970703125, 2651.5, 2675.81005859375, 2681.469970703125]	[2642.219970703125, 2651.5, 2675.81005859375, 2681.469970703125]	[8916630000, 17250300000, 19458420000, 7135450000]

# Try 1mo period
query IIIIIIII
select * FROM yahoo_finance("^GSPC", "2017-12-01"::DATE, "2018-06-20"::DATE, "1mo")
----
^GSPC	[2017-12-01, 2018-01-01, 2018-02-01, 2018-03-01, 2018-04-01, 2018-05-01, 2018-06-01]	[2645.10009765625, 2683.72998046875, 2816.449951171875, 2715.219970703125, 2633.449951171875, 2642.9599609375, 2718.699951171875]	[2694.969970703125, 2872.8701171875, 2835.9599609375, 2801.89990234375, 2717.489990234375, 2742.239990234375, 2791.469970703125]	[2605.52001953125, 2682.360107421875, 2532.68994140625, 2585.889892578125, 2553.800048828125, 2594.6201171875, 2691.989990234375]	[2673.610107421875, 2823.81005859375, 2713.830078125, 2640.8701171875, 2648.050048828125, 2705.27001953125, 2718.3701171875]	[2673.610107421875, 2823.81005859375, 2713.830078125, 2640.8701171875, 2648.050048828125, 2705.27001953125, 2718.3701171875]	[65531700000, 77318690000, 79933970000, 76803890000, 70194700000, 76011820000, 77891360000]

# Try 3mo period
query IIIIIIII
select * FROM yahoo_finance("^GSPC", "2017-12-01"::DATE, "2018-06-20"::DATE, "3mo")
----
^GSPC	[2017-12-01, 2018-03-01, 2018-06-01]	[2645.10009765625, 2715.219970703125, 2718.699951171875]	[2872.8701171875, 2801.89990234375, 2791.469970703125]	[2532.68994140625, 2553.800048828125, 2691.989990234375]	[2713.830078125, 2705.27001953125, 2718.3701171875]	[2713.830078125, 2705.27001953125, 2718.3701171875]	[222784360000, 223010410000, 77891360000]

# Try Big Data
query IIIIIIII
select * FROM yahoo_finance("BTC-USD", "2015-01-01"::DATE, "2015-04-01"::DATE, "1d");
----
BTC-USD	[2015-01-01, 2015-01-02, 2015-01-03, 2015-01-04, 2015-01-05, 2015-01-06, 2015-01-07, 2015-01-08, 2015-01-09, 2015-01-10, 2015-01-11, 2015-01-12, 2015-01-13, 2015-01-14, 2015-01-15, 2015-01-16, 2015-01-17, 2015-01-18, 2015-01-19, 2015-01-20, 2015-01-21, 2015-01-22, 2015-01-23, 2015-01-24, 2015-01-25, 2015-01-26, 2015-01-27, 2015-01-28, 2015-01-29, 2015-01-30, 2015-01-31, 2015-02-01, 2015-02-02, 2015-02-03, 2015-02-04, 2015-02-05, 2015-02-06, 2015-02-07, 2015-02-08, 2015-02-09, 2015-02-10, 2015-02-11, 2015-02-12, 2015-02-13, 2015-02-14, 2015-02-15]	[320.43499755859375, 314.0790100097656, 314.84600830078125, 281.14599609375, 265.0840148925781, 274.6109924316406, 286.0769958496094, 294.135009765625, 282.38299560546875, 287.3030090332031, 274.6080017089844, 266.14599609375, 267.3940124511719, 223.8939971923828, 176.89700317382812, 209.07000732421875, 207.83399963378906, 200.0500030517578, 211.4709930419922, 212.90699768066406, 211.3780059814453, 227.32200622558594, 233.51699829101562, 232.6999969482422, 247.3520050048828, 254.07899475097656, 273.1669921875, 263.35101318359375, 233.34800720214844, 232.77200317382812, 226.4409942626953, 216.86700439453125, 226.49099731445312, 237.45399475097656, 227.51100158691406, 227.6649932861328, 216.92300415039062, 222.63299560546875, 227.6929931640625, 223.38900756835938, 220.28199768066406, 219.73199462890625, 219.20799255371094, 221.968994140625, 235.5279998779297, 257.5069885253906]	[320.43499755859375, 315.8389892578125, 315.1499938964844, 287.2300109863281, 278.34100341796875, 287.5530090332031, 298.7539978027344, 294.135009765625, 291.114013671875, 288.12701416015625, 279.63800048828125, 272.2030029296875, 268.2770080566406, 223.8939971923828, 229.06700134277344, 221.59100341796875, 211.7310028076172, 218.69500732421875, 216.72799682617188, 215.24099731445312, 227.78799438476562, 237.0189971923828, 234.84500122070312, 248.2100067138672, 255.07400512695312, 309.3840026855469, 275.4800109863281, 266.5350036621094, 238.70599365234375, 242.8509979248047, 233.50399780273438, 231.57400512695312, 242.1750030517578, 245.95700073242188, 230.05799865722656, 239.40499877929688, 230.50999450683594, 230.2989959716797, 229.43800354003906, 223.9770050048828, 221.8070068359375, 223.406005859375, 222.19900512695312, 240.25900268554688, 259.8080139160156, 265.6109924316406]	[314.00299072265625, 313.56500244140625, 281.0820007324219, 257.61199951171875, 265.0840148925781, 272.6960144042969, 283.0790100097656, 282.17498779296875, 280.5329895019531, 273.96600341796875, 265.03900146484375, 265.20001220703125, 219.906005859375, 171.50999450683594, 176.89700317382812, 199.77099609375, 194.875, 194.50599670410156, 207.3179931640625, 205.1529998779297, 211.21200561523438, 226.4340057373047, 225.1959991455078, 230.02200317382812, 243.88999938964844, 254.07899475097656, 250.6529998779297, 227.04600524902344, 220.71200561523438, 225.83900451660156, 216.3090057373047, 212.01499938964844, 222.65899658203125, 224.48300170898438, 221.11300659179688, 214.72500610351562, 216.23199462890625, 222.60699462890625, 221.07699584960938, 217.0189971923828, 215.33200073242188, 218.07400512695312, 217.61399841308594, 221.26199340820312, 235.5279998779297, 227.6840057373047]	[314.2489929199219, 315.0320129394531, 281.0820007324219, 264.19500732421875, 274.4739990234375, 286.1889953613281, 294.3370056152344, 283.3489990234375, 290.4079895019531, 274.7959899902344, 265.6600036621094, 267.7959899902344, 225.86099243164062, 178.10299682617188, 209.843994140625, 208.0970001220703, 199.25999450683594, 210.33900451660156, 214.86099243164062, 211.31500244140625, 226.89700317382812, 233.406005859375, 232.87899780273438, 247.8470001220703, 253.71800231933594, 273.4729919433594, 263.4750061035156, 233.9149932861328, 233.51300048828125, 226.4250030517578, 217.46400451660156, 226.9720001220703, 238.22900390625, 227.26800537109375, 226.85299682617188, 217.11099243164062, 222.26600646972656, 227.75399780273438, 223.41200256347656, 220.11000061035156, 219.83900451660156, 219.18499755859375, 221.76400756835938, 235.427001953125, 257.3210144042969, 234.8249969482422]	[314.2489929199219, 315.0320129394531, 281.0820007324219, 264.19500732421875, 274.4739990234375, 286.1889953613281, 294.3370056152344, 283.3489990234375, 290.4079895019531, 274.7959899902344, 265.6600036621094, 267.7959899902344, 225.86099243164062, 178.10299682617188, 209.843994140625, 208.0970001220703, 199.25999450683594, 210.33900451660156, 214.86099243164062, 211.31500244140625, 226.89700317382812, 233.406005859375, 232.87899780273438, 247.8470001220703, 253.71800231933594, 273.4729919433594, 263.4750061035156, 233.9149932861328, 233.51300048828125, 226.4250030517578, 217.46400451660156, 226.9720001220703, 238.22900390625, 227.26800537109375, 226.85299682617188, 217.11099243164062, 222.26600646972656, 227.75399780273438, 223.41200256347656, 220.11000061035156, 219.83900451660156, 219.18499755859375, 221.76400756835938, 235.427001953125, 257.3210144042969, 234.8249969482422]	[8036550, 7860650, 33054400, 55629100, 43962800, 23245700, 24866800, 19982500, 18718600, 15264300, 18200800, 18880300, 72843904, 97638704, 81773504, 38421000, 23469700, 30085100, 18658300, 24051100, 29924600, 33544600, 24621700, 24782500, 33582700, 106794000, 44399000, 44352200, 32213400, 26605200, 23348200, 29128500, 30612100, 40783700, 26594300, 22516400, 24435300, 21604200, 17145200, 27791300, 21115100, 17201900, 15206200, 42744400, 49732500, 56552400]
BTC-USD	[2015-02-15, 2015-02-16, 2015-02-17, 2015-02-18, 2015-02-19, 2015-02-20, 2015-02-21, 2015-02-22, 2015-02-23, 2015-02-24, 2015-02-25, 2015-02-26, 2015-02-27, 2015-02-28, 2015-03-01, 2015-03-02, 2015-03-03, 2015-03-04, 2015-03-05, 2015-03-06, 2015-03-07, 2015-03-08, 2015-03-09, 2015-03-10, 2015-03-11, 2015-03-12, 2015-03-13, 2015-03-14, 2015-03-15, 2015-03-16, 2015-03-17, 2015-03-18, 2015-03-19, 2015-03-20, 2015-03-21, 2015-03-22, 2015-03-23, 2015-03-24, 2015-03-25, 2015-03-26, 2015-03-27, 2015-03-28, 2015-03-29, 2015-03-30, 2015-03-31, 2015-04-01]	[257.5069885253906, 234.8249969482422, 233.4219970703125, 243.77999877929688, 236.41000366210938, 240.25100708007812, 243.7519989013672, 244.54400634765625, 235.9949951171875, 238.9980010986328, 238.88999938964844, 237.33700561523438, 236.43600463867188, 253.52000427246094, 254.2830047607422, 260.35699462890625, 275.0459899902344, 281.989990234375, 272.739013671875, 275.6000061035156, 272.29400634765625, 276.4330139160156, 274.81201171875, 289.86199951171875, 291.5249938964844, 296.12701416015625, 294.1180114746094, 284.4419860839844, 281.42498779296875, 285.68499755859375, 290.5950012207031, 285.0669860839844, 255.8800048828125, 260.95599365234375, 261.6440124511719, 259.9169921875, 267.8949890136719, 266.5769958496094, 247.4720001220703, 246.2760009765625, 248.5659942626953, 246.97500610351562, 252.74000549316406, 242.87899780273438, 247.45399475097656, 244.22300720214844]	[265.6109924316406, 239.52099609375, 245.77499389648438, 244.25100708007812, 242.6719970703125, 247.1009979248047, 255.32000732421875, 246.39199829101562, 240.10899353027344, 239.9010009765625, 239.33999633789062, 237.7100067138672, 256.65301513671875, 254.69200134277344, 261.6600036621094, 276.3009948730469, 285.7959899902344, 284.2250061035156, 281.6669921875, 277.6080017089844, 277.85400390625, 277.8580017089844, 292.70098876953125, 300.04400634765625, 297.3909912109375, 297.0880126953125, 294.49798583984375, 286.3420104980469, 286.52899169921875, 294.11199951171875, 292.364990234375, 285.33599853515625, 264.2439880371094, 264.8479919433594, 262.1960144042969, 269.74700927734375, 277.2969970703125, 267.00299072265625, 249.19000244140625, 254.35400390625, 256.8110046386719, 254.2050018310547, 253.13900756835938, 249.24200439453125, 248.72999572753906, 247.54100036621094]	[227.6840057373047, 229.02200317382812, 232.31399536132812, 232.33999633789062, 235.5919952392578, 239.2989959716797, 243.1840057373047, 233.8509979248047, 232.42100524902344, 236.40199279785156, 235.52999877929688, 234.2570037841797, 236.43600463867188, 249.47900390625, 245.93299865722656, 258.31298828125, 268.1610107421875, 268.1260070800781, 264.7690124511719, 270.0150146484375, 270.13299560546875, 272.56500244140625, 273.89300537109375, 289.7430114746094, 290.50799560546875, 292.4129943847656, 285.3370056152344, 280.97601318359375, 280.9960021972656, 285.68499755859375, 284.3739929199219, 249.8699951171875, 248.63600158691406, 259.1619873046875, 255.64999389648438, 259.5899963378906, 261.7449951171875, 244.15499877929688, 236.51499938964844, 244.90499877929688, 245.21299743652344, 246.97500610351562, 240.85000610351562, 239.21400451660156, 242.73899841308594, 241.16000366210938]	[234.8249969482422, 233.84300231933594, 243.61000061035156, 236.3260040283203, 240.2830047607422, 243.7790069580078, 244.53399658203125, 235.9770050048828, 238.89199829101562, 238.73500061035156, 237.47000122070312, 236.42599487304688, 253.8280029296875, 254.26300048828125, 260.2019958496094, 275.6700134277344, 281.7019958496094, 273.0920104980469, 276.1780090332031, 272.7229919433594, 276.260986328125, 274.35400390625, 289.60699462890625, 291.760009765625, 296.3789978027344, 294.35400390625, 285.3370056152344, 281.885009765625, 286.39300537109375, 290.5929870605469, 285.5050048828125, 256.29901123046875, 260.9280090332031, 261.7489929199219, 260.0249938964844, 267.9599914550781, 266.739990234375, 245.59500122070312, 246.19700622558594, 248.53199768066406, 247.0290069580078, 252.79800415039062, 242.71299743652344, 247.5260009765625, 244.2239990234375, 247.27200317382812]	[234.8249969482422, 233.84300231933594, 243.61000061035156, 236.3260040283203, 240.2830047607422, 243.7790069580078, 244.53399658203125, 235.9770050048828, 238.89199829101562, 238.73500061035156, 237.47000122070312, 236.42599487304688, 253.8280029296875, 254.26300048828125, 260.2019958496094, 275.6700134277344, 281.7019958496094, 273.0920104980469, 276.1780090332031, 272.7229919433594, 276.260986328125, 274.35400390625, 289.60699462890625, 291.760009765625, 296.3789978027344, 294.35400390625, 285.3370056152344, 281.885009765625, 286.39300537109375, 290.5929870605469, 285.5050048828125, 256.29901123046875, 260.9280090332031, 261.7489929199219, 260.0249938964844, 267.9599914550781, 266.739990234375, 245.59500122070312, 246.19700622558594, 248.53199768066406, 247.0290069580078, 252.79800415039062, 242.71299743652344, 247.5260009765625, 244.2239990234375, 247.27200317382812]	[56552400, 28153700, 27363100, 25200800, 18270500, 23876700, 12284200, 19527000, 16400000, 14200400, 11496200, 13619400, 44013900, 13949300, 25213700, 40465700, 50461300, 41383000, 41302400, 28918900, 17825900, 22067900, 59178200, 67770800, 33963900, 32585200, 31421500, 22612300, 11970100, 21516100, 21497200, 57008000, 52732000, 18456700, 17130100, 18438100, 22811900, 40073700, 35866900, 25730000, 17274900, 16040900, 21699400, 23009600, 22672000, 22877200]

statement error
select * FROM yahoo_finance(["oejoeaijeao"], "2015-01-01"::DATE, "2015-04-01"::DATE, "1d");
----

statement error
select * FROM yahoo_finance([], "2015-01-01"::DATE, "2015-04-01"::DATE, "1d");
----

# Try Big Data
query IIIIIIII
select * FROM yahoo_finance(["BTC-USD", "^GSPC"], "2015-01-01"::DATE, "2015-04-01"::DATE, "1d");
----
BTC-USD	[2015-01-01, 2015-01-02, 2015-01-03, 2015-01-04, 2015-01-05, 2015-01-06, 2015-01-07, 2015-01-08, 2015-01-09, 2015-01-10, 2015-01-11, 2015-01-12, 2015-01-13, 2015-01-14, 2015-01-15, 2015-01-16, 2015-01-17, 2015-01-18, 2015-01-19, 2015-01-20, 2015-01-21, 2015-01-22, 2015-01-23, 2015-01-24, 2015-01-25, 2015-01-26, 2015-01-27, 2015-01-28, 2015-01-29, 2015-01-30, 2015-01-31, 2015-02-01, 2015-02-02, 2015-02-03, 2015-02-04, 2015-02-05, 2015-02-06, 2015-02-07, 2015-02-08, 2015-02-09, 2015-02-10, 2015-02-11, 2015-02-12, 2015-02-13, 2015-02-14, 2015-02-15]	[320.43499755859375, 314.0790100097656, 314.84600830078125, 281.14599609375, 265.0840148925781, 274.6109924316406, 286.0769958496094, 294.135009765625, 282.38299560546875, 287.3030090332031, 274.6080017089844, 266.14599609375, 267.3940124511719, 223.8939971923828, 176.89700317382812, 209.07000732421875, 207.83399963378906, 200.0500030517578, 211.4709930419922, 212.90699768066406, 211.3780059814453, 227.32200622558594, 233.51699829101562, 232.6999969482422, 247.3520050048828, 254.07899475097656, 273.1669921875, 263.35101318359375, 233.34800720214844, 232.77200317382812, 226.4409942626953, 216.86700439453125, 226.49099731445312, 237.45399475097656, 227.51100158691406, 227.6649932861328, 216.92300415039062, 222.63299560546875, 227.6929931640625, 223.38900756835938, 220.28199768066406, 219.73199462890625, 219.20799255371094, 221.968994140625, 235.5279998779297, 257.5069885253906]	[320.43499755859375, 315.8389892578125, 315.1499938964844, 287.2300109863281, 278.34100341796875, 287.5530090332031, 298.7539978027344, 294.135009765625, 291.114013671875, 288.12701416015625, 279.63800048828125, 272.2030029296875, 268.2770080566406, 223.8939971923828, 229.06700134277344, 221.59100341796875, 211.7310028076172, 218.69500732421875, 216.72799682617188, 215.24099731445312, 227.78799438476562, 237.0189971923828, 234.84500122070312, 248.2100067138672, 255.07400512695312, 309.3840026855469, 275.4800109863281, 266.5350036621094, 238.70599365234375, 242.8509979248047, 233.50399780273438, 231.57400512695312, 242.1750030517578, 245.95700073242188, 230.05799865722656, 239.40499877929688, 230.50999450683594, 230.2989959716797, 229.43800354003906, 223.9770050048828, 221.8070068359375, 223.406005859375, 222.19900512695312, 240.25900268554688, 259.8080139160156, 265.6109924316406]	[314.00299072265625, 313.56500244140625, 281.0820007324219, 257.61199951171875, 265.0840148925781, 272.6960144042969, 283.0790100097656, 282.17498779296875, 280.5329895019531, 273.96600341796875, 265.03900146484375, 265.20001220703125, 219.906005859375, 171.50999450683594, 176.89700317382812, 199.77099609375, 194.875, 194.50599670410156, 207.3179931640625, 205.1529998779297, 211.21200561523438, 226.4340057373047, 225.1959991455078, 230.02200317382812, 243.88999938964844, 254.07899475097656, 250.6529998779297, 227.04600524902344, 220.71200561523438, 225.83900451660156, 216.3090057373047, 212.01499938964844, 222.65899658203125, 224.48300170898438, 221.11300659179688, 214.72500610351562, 216.23199462890625, 222.60699462890625, 221.07699584960938, 217.0189971923828, 215.33200073242188, 218.07400512695312, 217.61399841308594, 221.26199340820312, 235.5279998779297, 227.6840057373047]	[314.2489929199219, 315.0320129394531, 281.0820007324219, 264.19500732421875, 274.4739990234375, 286.1889953613281, 294.3370056152344, 283.3489990234375, 290.4079895019531, 274.7959899902344, 265.6600036621094, 267.7959899902344, 225.86099243164062, 178.10299682617188, 209.843994140625, 208.0970001220703, 199.25999450683594, 210.33900451660156, 214.86099243164062, 211.31500244140625, 226.89700317382812, 233.406005859375, 232.87899780273438, 247.8470001220703, 253.71800231933594, 273.4729919433594, 263.4750061035156, 233.9149932861328, 233.51300048828125, 226.4250030517578, 217.46400451660156, 226.9720001220703, 238.22900390625, 227.26800537109375, 226.85299682617188, 217.11099243164062, 222.26600646972656, 227.75399780273438, 223.41200256347656, 220.11000061035156, 219.83900451660156, 219.18499755859375, 221.76400756835938, 235.427001953125, 257.3210144042969, 234.8249969482422]	[314.2489929199219, 315.0320129394531, 281.0820007324219, 264.19500732421875, 274.4739990234375, 286.1889953613281, 294.3370056152344, 283.3489990234375, 290.4079895019531, 274.7959899902344, 265.6600036621094, 267.7959899902344, 225.86099243164062, 178.10299682617188, 209.843994140625, 208.0970001220703, 199.25999450683594, 210.33900451660156, 214.86099243164062, 211.31500244140625, 226.89700317382812, 233.406005859375, 232.87899780273438, 247.8470001220703, 253.71800231933594, 273.4729919433594, 263.4750061035156, 233.9149932861328, 233.51300048828125, 226.4250030517578, 217.46400451660156, 226.9720001220703, 238.22900390625, 227.26800537109375, 226.85299682617188, 217.11099243164062, 222.26600646972656, 227.75399780273438, 223.41200256347656, 220.11000061035156, 219.83900451660156, 219.18499755859375, 221.76400756835938, 235.427001953125, 257.3210144042969, 234.8249969482422]	[8036550, 7860650, 33054400, 55629100, 43962800, 23245700, 24866800, 19982500, 18718600, 15264300, 18200800, 18880300, 72843904, 97638704, 81773504, 38421000, 23469700, 30085100, 18658300, 24051100, 29924600, 33544600, 24621700, 24782500, 33582700, 106794000, 44399000, 44352200, 32213400, 26605200, 23348200, 29128500, 30612100, 40783700, 26594300, 22516400, 24435300, 21604200, 17145200, 27791300, 21115100, 17201900, 15206200, 42744400, 49732500, 56552400]
BTC-USD	[2015-02-15, 2015-02-16, 2015-02-17, 2015-02-18, 2015-02-19, 2015-02-20, 2015-02-21, 2015-02-22, 2015-02-23, 2015-02-24, 2015-02-25, 2015-02-26, 2015-02-27, 2015-02-28, 2015-03-01, 2015-03-02, 2015-03-03, 2015-03-04, 2015-03-05, 2015-03-06, 2015-03-07, 2015-03-08, 2015-03-09, 2015-03-10, 2015-03-11, 2015-03-12, 2015-03-13, 2015-03-14, 2015-03-15, 2015-03-16, 2015-03-17, 2015-03-18, 2015-03-19, 2015-03-20, 2015-03-21, 2015-03-22, 2015-03-23, 2015-03-24, 2015-03-25, 2015-03-26, 2015-03-27, 2015-03-28, 2015-03-29, 2015-03-30, 2015-03-31, 2015-04-01]	[257.5069885253906, 234.8249969482422, 233.4219970703125, 243.77999877929688, 236.41000366210938, 240.25100708007812, 243.7519989013672, 244.54400634765625, 235.9949951171875, 238.9980010986328, 238.88999938964844, 237.33700561523438, 236.43600463867188, 253.52000427246094, 254.2830047607422, 260.35699462890625, 275.0459899902344, 281.989990234375, 272.739013671875, 275.6000061035156, 272.29400634765625, 276.4330139160156, 274.81201171875, 289.86199951171875, 291.5249938964844, 296.12701416015625, 294.1180114746094, 284.4419860839844, 281.42498779296875, 285.68499755859375, 290.5950012207031, 285.0669860839844, 255.8800048828125, 260.95599365234375, 261.6440124511719, 259.9169921875, 267.8949890136719, 266.5769958496094, 247.4720001220703, 246.2760009765625, 248.5659942626953, 246.97500610351562, 252.74000549316406, 242.87899780273438, 247.45399475097656, 244.22300720214844]	[265.6109924316406, 239.52099609375, 245.77499389648438, 244.25100708007812, 242.6719970703125, 247.1009979248047, 255.32000732421875, 246.39199829101562, 240.10899353027344, 239.9010009765625, 239.33999633789062, 237.7100067138672, 256.65301513671875, 254.69200134277344, 261.6600036621094, 276.3009948730469, 285.7959899902344, 284.2250061035156, 281.6669921875, 277.6080017089844, 277.85400390625, 277.8580017089844, 292.70098876953125, 300.04400634765625, 297.3909912109375, 297.0880126953125, 294.49798583984375, 286.3420104980469, 286.52899169921875, 294.11199951171875, 292.364990234375, 285.33599853515625, 264.2439880371094, 264.8479919433594, 262.1960144042969, 269.74700927734375, 277.2969970703125, 267.00299072265625, 249.19000244140625, 254.35400390625, 256.8110046386719, 254.2050018310547, 253.13900756835938, 249.24200439453125, 248.72999572753906, 247.54100036621094]	[227.6840057373047, 229.02200317382812, 232.31399536132812, 232.33999633789062, 235.5919952392578, 239.2989959716797, 243.1840057373047, 233.8509979248047, 232.42100524902344, 236.40199279785156, 235.52999877929688, 234.2570037841797, 236.43600463867188, 249.47900390625, 245.93299865722656, 258.31298828125, 268.1610107421875, 268.1260070800781, 264.7690124511719, 270.0150146484375, 270.13299560546875, 272.56500244140625, 273.89300537109375, 289.7430114746094, 290.50799560546875, 292.4129943847656, 285.3370056152344, 280.97601318359375, 280.9960021972656, 285.68499755859375, 284.3739929199219, 249.8699951171875, 248.63600158691406, 259.1619873046875, 255.64999389648438, 259.5899963378906, 261.7449951171875, 244.15499877929688, 236.51499938964844, 244.90499877929688, 245.21299743652344, 246.97500610351562, 240.85000610351562, 239.21400451660156, 242.73899841308594, 241.16000366210938]	[234.8249969482422, 233.84300231933594, 243.61000061035156, 236.3260040283203, 240.2830047607422, 243.7790069580078, 244.53399658203125, 235.9770050048828, 238.89199829101562, 238.73500061035156, 237.47000122070312, 236.42599487304688, 253.8280029296875, 254.26300048828125, 260.2019958496094, 275.6700134277344, 281.7019958496094, 273.0920104980469, 276.1780090332031, 272.7229919433594, 276.260986328125, 274.35400390625, 289.60699462890625, 291.760009765625, 296.3789978027344, 294.35400390625, 285.3370056152344, 281.885009765625, 286.39300537109375, 290.5929870605469, 285.5050048828125, 256.29901123046875, 260.9280090332031, 261.7489929199219, 260.0249938964844, 267.9599914550781, 266.739990234375, 245.59500122070312, 246.19700622558594, 248.53199768066406, 247.0290069580078, 252.79800415039062, 242.71299743652344, 247.5260009765625, 244.2239990234375, 247.27200317382812]	[234.8249969482422, 233.84300231933594, 243.61000061035156, 236.3260040283203, 240.2830047607422, 243.7790069580078, 244.53399658203125, 235.9770050048828, 238.89199829101562, 238.73500061035156, 237.47000122070312, 236.42599487304688, 253.8280029296875, 254.26300048828125, 260.2019958496094, 275.6700134277344, 281.7019958496094, 273.0920104980469, 276.1780090332031, 272.7229919433594, 276.260986328125, 274.35400390625, 289.60699462890625, 291.760009765625, 296.3789978027344, 294.35400390625, 285.3370056152344, 281.885009765625, 286.39300537109375, 290.5929870605469, 285.5050048828125, 256.29901123046875, 260.9280090332031, 261.7489929199219, 260.0249938964844, 267.9599914550781, 266.739990234375, 245.59500122070312, 246.19700622558594, 248.53199768066406, 247.0290069580078, 252.79800415039062, 242.71299743652344, 247.5260009765625, 244.2239990234375, 247.27200317382812]	[56552400, 28153700, 27363100, 25200800, 18270500, 23876700, 12284200, 19527000, 16400000, 14200400, 11496200, 13619400, 44013900, 13949300, 25213700, 40465700, 50461300, 41383000, 41302400, 28918900, 17825900, 22067900, 59178200, 67770800, 33963900, 32585200, 31421500, 22612300, 11970100, 21516100, 21497200, 57008000, 52732000, 18456700, 17130100, 18438100, 22811900, 40073700, 35866900, 25730000, 17274900, 16040900, 21699400, 23009600, 22672000, 22877200]
^GSPC	[2015-01-02, 2015-01-05, 2015-01-06, 2015-01-07, 2015-01-08, 2015-01-09, 2015-01-12, 2015-01-13, 2015-01-14, 2015-01-15, 2015-01-16, 2015-01-20, 2015-01-21, 2015-01-22, 2015-01-23, 2015-01-26, 2015-01-27, 2015-01-28, 2015-01-29, 2015-01-30, 2015-02-02, 2015-02-03, 2015-02-04, 2015-02-05, 2015-02-06, 2015-02-09, 2015-02-10, 2015-02-11, 2015-02-12, 2015-02-13]	[2058.89990234375, 2054.43994140625, 2022.1500244140625, 2005.550048828125, 2030.6099853515625, 2063.449951171875, 2046.1300048828125, 2031.5799560546875, 2018.4000244140625, 2013.75, 1992.25, 2020.760009765625, 2020.18994140625, 2034.300048828125, 2062.97998046875, 2050.419921875, 2047.8599853515625, 2032.3399658203125, 2002.449951171875, 2019.3499755859375, 1996.6700439453125, 2022.7099609375, 2048.860107421875, 2043.449951171875, 2062.280029296875, 2053.469970703125, 2049.3798828125, 2068.550048828125, 2069.97998046875, 2088.780029296875]	[2072.360107421875, 2054.43994140625, 2030.25, 2029.6099853515625, 2064.080078125, 2064.429931640625, 2049.300048828125, 2056.929931640625, 2018.4000244140625, 2021.3499755859375, 2020.4599609375, 2028.93994140625, 2038.2900390625, 2064.6201171875, 2062.97998046875, 2057.6201171875, 2047.8599853515625, 2042.489990234375, 2024.6400146484375, 2023.3199462890625, 2021.6600341796875, 2050.300048828125, 2054.739990234375, 2063.550048828125, 2072.39990234375, 2056.159912109375, 2070.860107421875, 2073.47998046875, 2088.530029296875, 2097.030029296875]	[2046.0400390625, 2017.3399658203125, 1992.43994140625, 2005.550048828125, 2030.6099853515625, 2038.3299560546875, 2022.5799560546875, 2008.25, 1988.43994140625, 1991.469970703125, 1988.1199951171875, 2004.489990234375, 2012.0400390625, 2026.3800048828125, 2050.5400390625, 2040.969970703125, 2019.9100341796875, 2001.489990234375, 1989.1800537109375, 1993.3800048828125, 1980.9000244140625, 2022.7099609375, 2036.719970703125, 2043.449951171875, 2049.969970703125, 2041.8800048828125, 2048.6201171875, 2057.989990234375, 2069.97998046875, 2086.699951171875]	[2058.199951171875, 2020.5799560546875, 2002.6099853515625, 2025.9000244140625, 2062.139892578125, 2044.81005859375, 2028.260009765625, 2023.030029296875, 2011.27001953125, 1992.6700439453125, 2019.4200439453125, 2022.550048828125, 2032.1199951171875, 2063.14990234375, 2051.820068359375, 2057.090087890625, 2029.550048828125, 2002.1600341796875, 2021.25, 1994.989990234375, 2020.8499755859375, 2050.030029296875, 2041.510009765625, 2062.52001953125, 2055.469970703125, 2046.739990234375, 2068.590087890625, 2068.530029296875, 2088.47998046875, 2096.989990234375]	[2058.199951171875, 2020.5799560546875, 2002.6099853515625, 2025.9000244140625, 2062.139892578125, 2044.81005859375, 2028.260009765625, 2023.030029296875, 2011.27001953125, 1992.6700439453125, 2019.4200439453125, 2022.550048828125, 2032.1199951171875, 2063.14990234375, 2051.820068359375, 2057.090087890625, 2029.550048828125, 2002.1600341796875, 2021.25, 1994.989990234375, 2020.8499755859375, 2050.030029296875, 2041.510009765625, 2062.52001953125, 2055.469970703125, 2046.739990234375, 2068.590087890625, 2068.530029296875, 2088.47998046875, 2096.989990234375]	[2708700000, 3799120000, 4460110000, 3805480000, 3934010000, 3364140000, 3456460000, 4107300000, 4378680000, 4276720000, 4056410000, 3944340000, 3730070000, 4176050000, 3573560000, 3465760000, 3329810000, 4067530000, 4127140000, 4568650000, 4008330000, 4615900000, 4141920000, 3821990000, 4232970000, 3549540000, 3669850000, 3596860000, 3788350000, 3527450000]
^GSPC	[2015-02-17, 2015-02-18, 2015-02-19, 2015-02-20, 2015-02-23, 2015-02-24, 2015-02-25, 2015-02-26, 2015-02-27, 2015-03-02, 2015-03-03, 2015-03-04, 2015-03-05, 2015-03-06, 2015-03-09, 2015-03-10, 2015-03-11, 2015-03-12, 2015-03-13, 2015-03-16, 2015-03-17, 2015-03-18, 2015-03-19, 2015-03-20, 2015-03-23, 2015-03-24, 2015-03-25, 2015-03-26, 2015-03-27, 2015-03-30, 2015-03-31]	[2096.469970703125, 2099.159912109375, 2099.25, 2097.64990234375, 2109.830078125, 2109.10009765625, 2115.300048828125, 2113.909912109375, 2110.8798828125, 2105.22998046875, 2115.760009765625, 2107.719970703125, 2098.5400390625, 2100.909912109375, 2072.25, 2076.139892578125, 2044.68994140625, 2041.0999755859375, 2064.56005859375, 2055.35009765625, 2080.590087890625, 2072.840087890625, 2098.68994140625, 2090.320068359375, 2107.989990234375, 2103.93994140625, 2093.10009765625, 2059.93994140625, 2055.780029296875, 2064.110107421875, 2084.050048828125]	[2101.300048828125, 2100.22998046875, 2102.1298828125, 2110.610107421875, 2110.050048828125, 2117.93994140625, 2119.590087890625, 2113.909912109375, 2112.739990234375, 2117.52001953125, 2115.760009765625, 2107.719970703125, 2104.25, 2100.909912109375, 2083.489990234375, 2076.139892578125, 2050.080078125, 2066.409912109375, 2064.56005859375, 2081.409912109375, 2080.590087890625, 2106.85009765625, 2098.68994140625, 2113.919921875, 2114.860107421875, 2107.6298828125, 2097.429931640625, 2067.14990234375, 2062.830078125, 2088.969970703125, 2084.050048828125]	[2089.800048828125, 2092.14990234375, 2090.7900390625, 2085.43994140625, 2103.0, 2105.8701171875, 2109.889892578125, 2103.760009765625, 2103.75, 2104.5, 2098.260009765625, 2094.489990234375, 2095.219970703125, 2067.27001953125, 2072.2099609375, 2044.1600341796875, 2039.68994140625, 2041.0999755859375, 2041.1700439453125, 2055.35009765625, 2065.080078125, 2061.22998046875, 2085.56005859375, 2090.320068359375, 2104.419921875, 2091.5, 2061.050048828125, 2045.5, 2052.9599609375, 2064.110107421875, 2067.0400390625]	[2100.340087890625, 2099.679931640625, 2097.449951171875, 2110.300048828125, 2109.659912109375, 2115.47998046875, 2113.860107421875, 2110.739990234375, 2104.5, 2117.389892578125, 2107.780029296875, 2098.530029296875, 2101.0400390625, 2071.260009765625, 2079.429931640625, 2044.1600341796875, 2040.239990234375, 2065.949951171875, 2053.39990234375, 2081.18994140625, 2074.280029296875, 2099.5, 2089.27001953125, 2108.10009765625, 2104.419921875, 2091.5, 2061.050048828125, 2056.14990234375, 2061.02001953125, 2086.239990234375, 2067.889892578125]	[2100.340087890625, 2099.679931640625, 2097.449951171875, 2110.300048828125, 2109.659912109375, 2115.47998046875, 2113.860107421875, 2110.739990234375, 2104.5, 2117.389892578125, 2107.780029296875, 2098.530029296875, 2101.0400390625, 2071.260009765625, 2079.429931640625, 2044.1600341796875, 2040.239990234375, 2065.949951171875, 2053.39990234375, 2081.18994140625, 2074.280029296875, 2099.5, 2089.27001953125, 2108.10009765625, 2104.419921875, 2091.5, 2061.050048828125, 2056.14990234375, 2061.02001953125, 2086.239990234375, 2067.889892578125]	[3361750000, 3370020000, 3247100000, 3281600000, 3093680000, 3199840000, 3312340000, 3408690000, 3547380000, 3409490000, 3262300000, 3421110000, 3103030000, 3853570000, 3349090000, 3668900000, 3406570000, 3405860000, 3498560000, 3295600000, 3221840000, 4128210000, 3305220000, 5554120000, 3267960000, 3189820000, 3521140000, 3510670000, 3008550000, 2917690000, 3376550000]

# Interval must be a string accepted by the yahoo api
statement error
select * FROM yahoo_finance("^GSPC", "2017-12-11"::DATE, "2017-12-12"::DATE, "bla")
----

# Periods can't be equal
statement error
select * FROM yahoo_finance("^GSPC", "2017-12-11"::DATE, "2017-12-11"::DATE, "1d")
----

# Interval can't be bigger than period
statement error
select * FROM yahoo_finance("^GSPC", "2017-12-11"::DATE, "2017-12-15"::DATE, "1mo")
----


# Start period must be castable to date
statement error
select * FROM yahoo_finance("^GSPC", "bla", "2017-12-15"::DATE, "1d")
----

# End period must be castable to date
statement error
select * FROM yahoo_finance("^GSPC", "2017-12-15"::DATE, "bla", "1d")
----

query I
select list_aggregate(close, 'volatility') FROM yahoo_finance("^GSPC", "2017-12-01"::DATE, "2017-12-10"::DATE, "1d")
----
7.640770797901039

query I
select list_aggregate(close, 'volatility') FROM yahoo_finance("^GSPC", "2017-12-01", "2017-12-10", "1d")
----
7.640770797901039

query I
select list_aggregate(close, 'sma') FROM yahoo_finance("^GSPC", "2017-12-01"::DATE, "2017-12-10"::DATE, "1d")
----
2638.16333

query I
select list_aggregate(close, 'volatility') FROM yahoo_finance("^GSPC", "2023-01-01"::DATE, "2023-02-18"::DATE, "1d")
----
101.31567537720929

query I
select list_aggregate(close, 'volatility') FROM yahoo_finance("BTC-USD", "2023-01-01"::DATE, "2023-02-18"::DATE, "1d");
----
2535.839600150706
